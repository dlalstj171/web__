<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q&A 게시판</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* [전체 공통 스타일] */
        body { margin: 0; padding: 0; background-color: #f4f6f8; font-family: 'Noto Sans KR', sans-serif; }
        ul, li { list-style: none; margin: 0; padding: 0; }
        a { text-decoration: none; color: #333; }

        /* [상단 헤더 스타일] */
        .main-header {
            background-color: #cccccc; /* 회색 배경 */
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #bbb;
        }

        .header-logo img {
            height: 40px;
            vertical-align: middle;
        }

        /* 메뉴 가로 정렬 */
        .header-nav {
            display: flex; 
            gap: 15px;
        }
        
        .header-nav li {
            display: inline-block;
        }

        .header-nav a {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            transition: color 0.2s;
        }

        .header-nav a:hover {
            color: #000;
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="header-logo">
            <a href="main.html">
                <img src="logo.png" alt="easy trip" onerror="this.style.display='none'; this.parentNode.innerHTML='<b>easy trip</b>'">
            </a>
        </div>

        <ul class="header-nav">
            <li><a href="main.html">| HOME |</a></li>
            <li><a href="region.html">| 주요도시 |</a></li>
            <li><a href="review_list.html">| 여행 후기 |</a></li>
            <li><a href="guide.html">| 이용가이드 |</a></li>
            <li><a href="qna.html">| Q&A |</a></li>
            <li><a href="index.html">| 포트폴리오 |</a></li>
        </ul>
    </header>


    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = "http://localhost:3000";

        const styles = {
            container: {
                width: "100%", maxWidth: "1000px", margin: "40px auto", padding: "0 20px", boxSizing: "border-box"
            },
            card: {
                backgroundColor: "white", padding: "30px", borderRadius: "10px",
                boxShadow: "0 2px 10px rgba(0,0,0,0.05)", marginBottom: "20px", border: "1px solid #eee"
            },
            button: {
                backgroundColor: "#555",
                color: "white", padding: "12px 0", border: "none",
                borderRadius: "4px", fontSize: "1rem", fontWeight: "bold", cursor: "pointer", width: "100%"
            }
        };

        const Qna = () => {
            const [list, setList] = useState([]);
            // const [users, setUsers] = useState([]); // 유저 목록 불러오기 삭제 (필요 없음)
            // const [currentUser, setCurrentUser] = useState("익명"); // 작성자 선택 상태 삭제
            const [inputs, setInputs] = useState({ region: "지역 선택", category: "분류 선택", title: "", content: "" });
            const regions = ["서울", "경기", "인천", "강원", "충청", "대전", "세종", "전라", "광주", "경상", "대구", "부산", "울산", "제주"];

            useEffect(() => { fetchList(); }, []); // fetchUsers 제거

            const fetchList = async () => {
                try {
                    const res = await fetch(`${API_BASE}/api/qna`);
                    const data = await res.json();
                    setList(Array.isArray(data) ? data : []);
                } catch (err) { console.error(err); }
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                setInputs({ ...inputs, [name]: value });
            };

            const handleSubmit = async () => {
                if (inputs.region === "지역 선택" || inputs.category === "분류 선택" || !inputs.title || !inputs.content) {
                    alert("모든 항목을 입력해주세요."); return;
                }
                try {
                    const res = await fetch(`${API_BASE}/api/qna`, {
                        method: "POST", headers: { "Content-Type": "application/json" },
                        // ★ [핵심 수정] writer를 무조건 "익명"으로 고정해서 보냄
                        body: JSON.stringify({ ...inputs, writer: "익명" })
                    });
                    if (res.ok) {
                        alert("등록되었습니다.");
                        setInputs({ region: "지역 선택", category: "분류 선택", title: "", content: "" });
                        fetchList();
                    }
                } catch (err) { alert("서버 연결 실패"); }
            };

            return (
                <div style={styles.container}>
                    <div style={{ textAlign: "center", marginBottom: "30px" }}>
                        <h2 style={{ fontSize: "2rem", color: "#333", margin: 0 }}>Q&A 게시판</h2>
                    </div>

                    {/* 사용자 선택 및 입력 폼 */}
                    <div style={styles.card}>
                        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "20px" }}>
                            <span style={{ fontSize: "1.1rem", fontWeight: "bold" }}>질문 작성</span>
                            
                            {/* ★ [삭제됨] 여기에 있던 작성자 선택(select) 박스를 지웠습니다. */}
                            
                        </div>

                        <div style={{ display: "flex", gap: "10px", marginBottom: "10px" }}>
                            <select name="region" value={inputs.region} onChange={handleChange} style={inputStyle}>
                                <option>지역 선택</option>{regions.map(r => <option key={r} value={r}>{r}</option>)}
                            </select>
                            <select name="category" value={inputs.category} onChange={handleChange} style={inputStyle}>
                                <option>분류 선택</option><option>관광지</option><option>맛집</option><option>교통</option><option>기타</option>
                            </select>
                        </div>
                        <input type="text" name="title" placeholder="제목" value={inputs.title} onChange={handleChange} style={{...inputStyle, width: "100%", boxSizing: "border-box"}} />
                        <textarea name="content" placeholder="내용을 입력하세요" value={inputs.content} onChange={handleChange} style={{...inputStyle, width: "100%", height: "150px", resize: "none", boxSizing: "border-box"}}></textarea>
                        
                        <button onClick={handleSubmit} style={styles.button}>질문 등록</button>
                    </div>

                    {/* 목록 */}
                    <div style={{ marginTop: "40px" }}>
                        <h3 style={{ borderBottom: "2px solid #333", paddingBottom: "10px", margin: "0 0 20px 0", color: "#333" }}>최근 질문</h3>
                        {list.length === 0 ? <div style={{ textAlign: "center", padding: "50px", color: "#999" }}>질문이 없습니다.</div> : 
                            list.map((item, index) => (
                                <div key={index} style={{ backgroundColor: "white", padding: "20px", borderRadius: "10px", marginBottom: "15px", boxShadow: "0 2px 5px rgba(0,0,0,0.05)" }}>
                                    <div style={{ display: "flex", gap: "8px", marginBottom: "8px", fontSize: "0.85rem" }}>
                                        <span style={badgeStyle}>{item.region}</span>
                                        <span style={badgeStyle}>{item.category}</span>
                                        <span style={{ color: "#333", fontWeight: "bold" }}>{item.writer}</span>
                                        <span style={{ marginLeft: "auto", color: "#aaa" }}>{item.createdAt ? new Date(item.createdAt).toLocaleDateString() : ""}</span>
                                    </div>
                                    <div style={{ fontSize: "1.2rem", fontWeight: "bold", marginBottom: "6px", color: "#333" }}>{item.title}</div>
                                    <div style={{ color: "#555" }}>{item.content}</div>
                                </div>
                            ))
                        }
                    </div>
                </div>
            );
        };

        const inputStyle = { padding: "12px", border: "1px solid #ddd", borderRadius: "6px", fontSize: "1rem", outline: "none", flex: 1 };
        const badgeStyle = { backgroundColor: "#eee", color: "#555", padding: "4px 10px", borderRadius: "12px", fontWeight: "500" };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Qna />);
    </script>
</body>
</html>